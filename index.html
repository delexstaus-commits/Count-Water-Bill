<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Neon Water Bill</title>
    <style>
        :root {
            --neon-red: #ff0000;
            --neon-green: #00ff41;
            --dark-bg: #0a0a0a;
        }

        body {
            background-color: var(--dark-bg);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            touch-action: manipulation;
        }

        .header-popup {
            background: #111;
            border: 2px solid var(--neon-red);
            border-radius: 50px;
            padding: 10px 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            box-shadow: 0 0 15px var(--neon-red);
        }

        .header-title {
            color: var(--neon-red);
            text-shadow: 0 0 10px var(--neon-red);
            font-size: 18px;
            font-weight: bold;
            text-transform: uppercase;
            margin: 0;
        }

        .calc-toggle-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .calc-toggle-btn svg {
            width: 30px;
            height: 30px;
            fill: var(--neon-red);
            filter: drop-shadow(0 0 5px var(--neon-red));
        }

        .container {
            width: 95%;
            max-width: 600px;
            background: #111;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid var(--neon-red);
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.2);
            box-sizing: border-box;
        }

        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        
        input {
            width: 100%;
            padding: 12px;
            background: #222;
            border: 1px solid var(--neon-red);
            color: white;
            border-radius: 5px;
            box-sizing: border-box;
            outline: none;
        }

        button.calc-btn {
            width: 100%;
            padding: 15px;
            background: var(--neon-red);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 15px var(--neon-red);
            font-size: 16px;
        }

        #floating-calc {
            position: fixed;
            top: 120px;
            left: 20px;
            width: 260px;
            background: #000;
            border: 2px solid var(--neon-red);
            border-radius: 12px;
            padding: 10px;
            display: none;
            z-index: 2000;
            box-shadow: 0 0 30px var(--neon-red);
            touch-action: none;
        }

        .calc-header {
            background: var(--neon-red);
            height: 35px;
            cursor: move;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 12px;
            margin: -10px -10px 10px -10px;
        }

        .close-calc-btn {
            background: black;
            color: white;
            border: none;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #calc-display {
            width: 100%;
            height: 45px;
            background: #222;
            color: var(--neon-green);
            text-align: right;
            padding: 10px;
            font-size: 22px;
            border: 1px solid #444;
            margin-bottom: 10px;
            box-sizing: border-box;
        }

        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
        .calc-grid button {
            padding: 12px;
            background: #1a1a1a;
            color: white;
            border: 1px solid #333;
            cursor: pointer;
            border-radius: 5px;
        }

        #results-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
            width: 100%;
            max-width: 1200px;
        }

        .card { background: #111; border: 1px solid var(--neon-red); padding: 20px; border-radius: 20px; position: relative; }
        .rotate-btn { position: absolute; top: 10px; right: 10px; background: transparent; border: 1px solid var(--neon-red); border-radius: 50%; cursor: pointer; font-size: 20px; color: white; }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(15px);
            display: none; justify-content: center; align-items: center; z-index: 1000;
        }

        .rotated-card {
            background: #0d0d0d; border: 2px solid var(--neon-red); padding: 30px; border-radius: 25px;
            width: 80vh; max-width: 600px; transform: rotate(90deg); box-shadow: 0 0 40px var(--neon-red);
        }

        .summary-box {
            background: #111; border: 2px solid var(--neon-green); padding: 25px; margin-top: 40px; border-radius: 20px;
            text-align: center; width: 95%; max-width: 600px; box-sizing: border-box;
        }

        .neon-text { color: var(--neon-red); font-weight: bold; }
        .green-neon-text { color: var(--neon-green); font-weight: bold; }
        .val { float: right; font-weight: bold; }
        hr { border: 0.1px solid #333; margin: 15px 0; }
    </style>
</head>
<body>

    <div class="header-popup">
        <h2 class="header-title">WATER BILL</h2>
        <button class="calc-toggle-btn" onclick="toggleCalc()">
            <svg viewBox="0 0 24 24"><path d="M19,2H5C3.89,2 3,2.89 3,4V20C3,21.11 3.89,22 5,22H19C20.11,22 21,21.11 21,20V4C21,2.89 20.11,2 19,2M19,20H5V4H19V20M7,18H9V16H7V18M11,18H13V16H11V18M15,18H17V16H15V18M7,14H9V12H7V14M11,14H13V12H11V14M15,14H17V12H15V14M7,10H9V8H7V10M11,10H13V8H11V10M15,10H17V8H15V10M7,6H17V7H7V6Z" /></svg>
        </button>
    </div>

    <div id="floating-calc">
        <div class="calc-header">
            <span style="font-size: 11px; font-weight: bold; color: white;">DRAG & ZOOM</span>
            <button class="close-calc-btn" onclick="toggleCalc()">X</button>
        </div>
        <input type="text" id="calc-display" readonly>
        <div class="calc-grid">
            <button onclick="clearCalc()">C</button>
            <button onclick="press('/')">/</button>
            <button onclick="press('*')">*</button>
            <button onclick="press('-')">-</button>
            <button onclick="press('7')">7</button>
            <button onclick="press('8')">8</button>
            <button onclick="press('9')">9</button>
            <button onclick="press('+')">+</button>
            <button onclick="press('4')">4</button>
            <button onclick="press('5')">5</button>
            <button onclick="press('6')">6</button>
            <button onclick="calcResult()">=</button>
            <button onclick="press('1')">1</button>
            <button onclick="press('2')">2</button>
            <button onclick="press('3')">3</button>
            <button onclick="press('0')">0</button>
        </div>
    </div>

    <div class="container">
        <div class="input-group">
            <label>‡∂∏‡∑î‡∑Ö‡∑î ‡∂∏‡∑î‡∂Ø‡∂Ω ‡∂á‡∂≠‡∑î‡∂Ω‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±:</label>
            <input type="number" id="mainTotal">
        </div>
        <hr>
        <div id="unit-inputs"></div>
        <button class="calc-btn" onclick="calculate()">‡∂ú‡∂´‡∂±‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
    </div>

    <div id="results-container"></div>
    <div id="final-summary" class="summary-box" style="display:none;"></div>

    <div id="overlay" class="overlay" onclick="closeRotate()">
        <div id="rotate-target" class="rotated-card"></div>
    </div>

    <script>
        // Calc Logic
        let currentInput = "";
        function press(v) { currentInput += v; document.getElementById('calc-display').value = currentInput; }
        function clearCalc() { currentInput = ""; document.getElementById('calc-display').value = ""; }
        function calcResult() { try { currentInput = eval(currentInput).toString(); document.getElementById('calc-display').value = currentInput; } catch { alert("Error"); clearCalc(); } }
        function toggleCalc() { let el = document.getElementById('floating-calc'); el.style.display = (el.style.display === 'none') ? 'block' : 'none'; }

        // Drag/Zoom Logic
        const calc = document.getElementById('floating-calc');
        let scale = 1, evCache = [], prevDiff = -1;
        calc.onpointerdown = (e) => { evCache.push(e); calc.setPointerCapture(e.pointerId); };
        calc.onpointermove = (e) => {
            const index = evCache.findIndex((item) => item.pointerId === e.pointerId);
            evCache[index] = e;
            if (evCache.length === 2) {
                const curDiff = Math.hypot(evCache[0].clientX - evCache[1].clientX, evCache[0].clientY - evCache[1].clientY);
                if (prevDiff > 0) {
                    scale += (curDiff > prevDiff ? 0.02 : -0.02);
                    scale = Math.min(Math.max(0.5, scale), 2);
                    calc.style.transform = `scale(${scale})`;
                }
                prevDiff = curDiff;
            } else if (evCache.length === 1) {
                calc.style.left = (e.clientX - calc.offsetWidth / 2) + 'px';
                calc.style.top = (e.clientY - 20) + 'px';
            }
        };
        calc.onpointerup = (e) => { evCache = evCache.filter((i) => i.pointerId !== e.pointerId); if (evCache.length < 2) prevDiff = -1; };

        // THE THEORY - STEP BY STEP
        const names = ["‡∂≠‡∑í‡∑É‡∑è‡∑Ñ‡∑è‡∂∏‡∑ì", "‡∂ß‡∑í‡∂ö‡∑í‡∂ª‡∑í‡∂∂‡∂Ç‡∂©‡∑è", "‡∂†‡∂∏‡∑ä‡∂¥‡∑ì", "‡∂¥‡∑î‡∂Ç‡∂†‡∑í ‡∂∂‡∂Ç‡∂©‡∑è", "‡∑É‡∑î‡∂Ø‡∑î‡∂∂‡∂´‡∑ä‡∂©‡∑è", "‡∑Ñ‡∑è‡∂∏‡∑ñ", "‡∂ú‡∑î‡∂´‡∑Ä‡∂≠‡∑ì", "‡∂Ü‡∂ª‡∑í‡∂∫‡∑É‡∑ö‡∂±"];
        const inputDiv = document.getElementById('unit-inputs');
        names.forEach((name, i) => {
            inputDiv.innerHTML += `<div class="input-group"><label>${i + 1}. ${name}</label><input type="number" class="unit-input" id="unit-${i}"></div>`;
        });

        function calculate() {
            const mainTotalInput = parseFloat(document.getElementById('mainTotal').value) || 0;
            
            // 1. ‡∂∏‡∑î‡∑Ö‡∑î ‡∂∏‡∑î‡∂Ø‡∂Ω‡∑í‡∂±‡∑ä 744‡∂ö‡∑ä ‡∂Ö‡∂©‡∑î ‡∂ö‡∂ª‡∂¥‡∂±‡∑ä
            const amountMinus744 = mainTotalInput - 744;

            let totalUnits = 0;
            let unitsArr = [];
            for (let i = 0; i < 8; i++) {
                let v = parseFloat(document.getElementById(`unit-${i}`).value) || 0;
                unitsArr.push(v);
                // ‡∂í‡∂ö‡∂ö ‡∑Ä‡∂Ω ‡∂ë‡∂ö‡∂≠‡∑î‡∑Ä ‡∂ú‡∂±‡∑í‡∂±‡∑ä
                totalUnits += v;
            }

            if (totalUnits === 0) { alert("‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂í‡∂ö‡∂ö ‡∂á‡∂≠‡∑î‡∂Ω‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±!"); return; }

            // 2. ‡∂∏‡∑î‡∑Ö‡∑î ‡∂∏‡∑î‡∂Ø‡∂Ω‡∑í‡∂±‡∑ä 744‡∂ö‡∑ä ‡∂Ö‡∂©‡∑î ‡∂ö‡∂ª‡∑è‡∂∏ ‡∂ë‡∂± ‡∂ú‡∑è‡∂± ‡∂í‡∂ö‡∂ö ‡∂ë‡∂ö‡∂≠‡∑î‡∑Ä‡∑ô‡∂±‡∑ä ‡∂∂‡∑ô‡∂Ø‡∂¥‡∂±‡∑ä
            // (‡∑É‡∂≠ ‡∂ú‡∂´‡∂±‡∑ä ‡∂±‡∑ê‡∂≠‡∑í‡∑Ä ‡∑Ä‡∂ß‡∂∫‡∂±‡∑Ä‡∑è)
            const unitPrice = Math.round(amountMinus744 / totalUnits);

            let calculatedGrandTotal = 0;
            let resultsHTML = '';

            unitsArr.forEach((u, i) => {
                // 3. ‡∂∂‡∑ô‡∂Ø‡∑î‡∑Ä‡∂ß ‡∂¥‡∑É‡∑ä‡∑É‡∑ö ‡∂ë‡∂± ‡∂ú‡∑è‡∂±‡∑ô‡∂±‡∑ä ‡∂ú‡∑î‡∂± ‡∂ö‡∂ª‡∂Ω‡∑è ‡∂í‡∂ö‡∂ß ‡∂Ö‡∂±‡∑í‡∑Ä‡∑è‡∂ª‡∑ä‡∂∫ ‡∂∏‡∑î‡∂Ø‡∂Ω 193‡∂ö‡∑ä ‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∂ª‡∂¥‡∂±‡∑ä
                let individualPrice = Math.round((u * unitPrice) + 193);
                calculatedGrandTotal += individualPrice;

                resultsHTML += `
                    <div class="card">
                        <button class="rotate-btn" onclick="openRotate('${names[i]}', ${unitPrice}, ${u}, 193, ${individualPrice})">üîÑ</button>
                        <h3 class="neon-text" style="text-align:center;">${names[i]}</h3>
                        <p>1. ‡∂í‡∂ö‡∂ö‡∂∫‡∂ö ‡∂∏‡∑í‡∂Ω: <span class="val">‡∂ª‡∑î. ${unitPrice}</span></p>
                        <p>2. ‡∂í‡∂ö‡∂ö ‡∂ú‡∂´‡∂±: <span class="val">${u}</span></p>
                        <p>3. ‡∂Ö‡∂±‡∑í‡∑Ä‡∑è‡∂ª‡∑ä‡∂∫ ‡∂∏‡∑î‡∂Ø‡∂Ω: <span class="val">‡∂ª‡∑î. 193</span></p><hr>
                        <p class="neon-text">4. ‡∂∏‡∑î‡∑Ö‡∑î ‡∂∏‡∑î‡∂Ø‡∂Ω: <span class="val">‡∂ª‡∑î. ${individualPrice}</span></p>
                    </div>`;
            });

            document.getElementById('results-container').innerHTML = resultsHTML;

            // 4. ‡∂∏‡∑î‡∑Ö‡∑î ‡∂ë‡∂ö‡∂≠‡∑î‡∑Ä‡∑ô‡∂±‡∑ä ‡∂∏‡∑î‡∂Ω‡∑ä ‡∂∏‡∑î‡∂Ø‡∂Ω ‡∂Ö‡∂©‡∑î ‡∂ö‡∂ª‡∂Ω‡∑è ‡∑Ä‡∑ô‡∂±‡∑É ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂±‡∑ä‡∂±
            const diff = calculatedGrandTotal - mainTotalInput;

            const summary = document.getElementById('final-summary');
            summary.style.display = 'block';
            summaryDiv = `
                <h3 class="green-neon-text">‡∂ú‡∂´‡∂±‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ä ‡∑É‡∑è‡∂ª‡∑è‡∂Ç‡∑Å‡∂∫</h3>
                <p>‡∑É‡∑í‡∂∫‡∂Ω‡∑î ‡∂Ø‡∑ô‡∂±‡∑è‡∂ú‡∑ö ‡∂∏‡∑î‡∑Ö‡∑î ‡∂ë‡∂ö‡∂≠‡∑î‡∑Ä: <span class="val" style="float:none;">‡∂ª‡∑î. ${calculatedGrandTotal}</span></p><hr>
                <p>‡∂∏‡∑î‡∂Ω‡∑ä ‡∂∏‡∑î‡∂Ø‡∂Ω ‡∑É‡∂∏‡∂ü ‡∑Ä‡∑ô‡∂±‡∑É:</p>
                <div class="green-neon-text" style="font-size:24px;">‡∂ª‡∑î. ${diff}</div>
            `;
            summary.innerHTML = summaryDiv;
            summary.scrollIntoView({ behavior: 'smooth' });
        }

        function openRotate(n, up, uc, mf, t) {
            const target = document.getElementById('rotate-target');
            target.innerHTML = `<h2 class="neon-text" style="text-align:right;">${n}</h2><p>1. ‡∂í‡∂ö‡∂ö‡∂∫‡∂ö ‡∂∏‡∑í‡∂Ω: <span class="val">‡∂ª‡∑î. ${up}</span></p><br><p>2. ‡∂í‡∂ö‡∂ö ‡∂ú‡∂´‡∂±: <span class="val">${uc}</span></p><br><p>3. ‡∂Ö‡∂±‡∑í‡∑Ä‡∑è‡∂ª‡∑ä‡∂∫ ‡∂∏‡∑î‡∂Ø‡∂Ω: <span class="val">‡∂ª‡∑î. ${mf}</span></p><br><hr><p class="neon-text" style="font-size:22px;">4. ‡∂∏‡∑î‡∑Ö‡∑î ‡∂∏‡∑î‡∂Ø‡∂Ω: <span class="val">‡∂ª‡∑î. ${t}</span></p>`;
            document.getElementById('overlay').style.display = 'flex';
        }
        function closeRotate() { document.getElementById('overlay').style.display = 'none'; }
    </script>
</body>
</html>
